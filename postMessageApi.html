<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>postMessage API</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["json"]);
        });
      </script>
  </head>

  <body class="postMessageApi">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="json">json</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="overview-postmessage-api">Overview - postMessage API</h1>

<aside class="notice">
This part of the docs is in-progress.
</aside>

<h1 id="iframe-messaging">Iframe messaging</h1>

<p>The <a href="#edmdesignerapiopenprojectprojectid-languagecode-settings-callback-onerrorcb">edmDesignerApi.openProject</a> function will return an iframe. It is possible to communicate with this iframe with the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">window.postMessage</a> native method.</p>

<h3 id="special-elements-and-features">Special elements and features</h3>

<p>There are some speciel elements and functionalities what can be used with iframe messaging. You can configure most of this features in our <a href="dashboard.edmdesigner.com">dashboard</a>. The basic concept behind this feature is that this configurable elements and buttons will post a message (with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">window.postMessage</a> native method which was mentioned above) to the parent window (it should be your site). You should handle the message on your side, it does not matter how, and send back the content with the corresponding action name (<a href="#possbile-messages-to-send">see below</a>). For example: a popup window where the user can take some action, set what kind of content he wants to use, and you should send back this content wiht the right action name.</p>

<hr>

<h3 id="wysiwyg-texteditor-buttons">Wysiwyg texteditor buttons</h3>

<p>You can insert custom strings to the cursor position in the wysiwyg editor. With this feature you can configure texteditor buttons, which will appear in the wysiwyg editor&rsquo;s toolbar. There can be as many different texteditor buttons as you want. Each button can have its own label. If a user clicks one of this buttons, it posts a message to the parent window with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage">window.postMessage</a> native method. This messages can be configured too in our <a href="dashboard.edmdesigner.com">dashboard</a>.<br>
The basic usecase of a texteditor button: The user edits one of his text or title, and wants to insert some custom string so he clicks to one of the texteditor buttons. It posts the configured <a href="#texteditor-button-message-format">message</a> to the parent window (which should be your site) where you should provide an interface where he can choose which custom string he wants to use. The selected string should be posted back with the right <a href="#insert-to-cursor-in-wysiwyg-editor">action name</a> to our iframe.<br>
<strong>Please note that if you want the content to be unchanged/untouched in the generated html code then you should generate that code with the &ldquo;<a href="#generate-without-sanitizing">generate without sanitizing</a>&rdquo; route (instead of the normal <a href="#generate">generate</a> route. That way the generated code won&rsquo;t be safe enough, so after you replaced your placeholders YOU SHOULD SANITIZE the code (with <a href="https://code.google.com/p/google-caja/wiki/JsHtmlSanitizer">google caja</a>)</strong></p>

<h3 id="texteditor-button-message-format">Texteditor button message format</h3>

<p>When a user clicks a texteditor button, we post you (parent window) a message. This message is a stringified json with two parameters:
  - action {String} The action name you configured for this type of code elements
  - content {String} The selected text in the editor (if there is any. It will be null if there is no selected text). Plesae note that the selected text will always be overriden with the content you send in the <a href="#insert-to-cursor-in-wysiwyg-editor">repsonse</a>. If you want to keep the selected text then you should send it back in/with your content.</p>

<p>example: <strong>&ldquo;{\&quot;action\&rdquo;: \&ldquo;the action you configured for this texteditor button\&rdquo;, \&ldquo;content\&rdquo;: \&ldquo;the selected text or null if there is no selected text\&rdquo;}&ldquo;</strong></p>

<h3 id="texteditor-button-39-s-structure">Texteditor button&rsquo;s structure</h3>

<p>A texteditor button configuration has the following parameters:
  - id : The id/type of the texteditor button. This is what distinguish one button from another.
  - action : The message our iframe will send to you when a user clicks the texteditor button belonging to this configuration. (You can find how you have to respond to this message <a href="#insert-to-cursor-in-wysiwyg-editor">here</a>) 
  - label : The name of the button. This will appear as the label of the button. It is localizable and works quite similar like the <a href="#localization">header/footer localization</a>. Please note that the &quot;en&rdquo; value is the default value, so it should always be set.</p>

<p>You can configure your texteditor buttons for:
  * <a href="dashboard.edmdesigner.com/#textEditorButton/general">every instance</a>
  * <a href="dashboard.edmdesigner.com/#textEditorButton/instance">every user belonging to one instance</a>
  * <a href="dashboard.edmdesigner.com/#textEditorButton/group">a group of user</a>
  * <a href="dashboard.edmdesigner.com/#textEditorButton/user">some selected user</a></p>

<p>A user inherits a texteditor button settings just like it is explained in the <a href="#feature-configuration">feature configuration</a> part of the documentation</p>

<hr>

<h3 id="possbile-messages-to-send">Possbile messages to send</h3>

<p>List of the events you can send to the iframe (as a message).  </p>

<h3 id="save-project">Save Project</h3>

<p>It is possible to manualy ask the iframe to save the actual (opened) project. As a response the iframe will post a <a href="#save-result">save result</a> message.<br>
The message you need to send: <strong>saveProject</strong></p>

<h3 id="force-selected-element-to-be-deselected">Force selected element to be deselected</h3>

<p>It is possible to force the editor to deselect the actual selected element. There won&rsquo;t be any kind of response (from the api iframe) to this message.
The message you need to send: <strong>loseSelected</strong></p>

<h3 id="insert-to-cursor-in-wysiwyg-editor">Insert to cursor in wysiwyg editor</h3>

<p>The response for the incoming messages from <a href="#wysiwyg-texteditor-button">texteditor buttons</a>. You need to post a stringified json as the message string. It should have two properties:
  - action {String} The name of the action: <strong>InsertToCursor</strong>
  - content {String} The content (placeholders) the user wants to insert to the cursor </p>

<p>The message you need to send: <strong>{&ldquo;action&rdquo;: &ldquo;InsertToCursor&rdquo;, &ldquo;content&rdquo;: &ldquo;your content goes here&rdquo;}</strong></p>

<hr>

<h3 id="possible-response-messages">Possible response messages</h3>

<p>List of the events the iframe can send to your application (as a message).</p>

<h3 id="save-result">Save result</h3>

<p>It is the answer for the <a href="#save project">save project</a> request. It can have to different statuses:<br>
In case of success the answer message will be the following: <strong>Save result: success</strong><br>
In case of failure the answer message will be the following: <strong>Save result: failed</strong>  </p>

<h3 id="project-loading-started">Project Loading Started</h3>

<p>The iframe will send you a message at the begining of the project loading.
The message will be the following: <strong>ProjectLoadingStarted</strong></p>

<h3 id="project-loading-finished">Project Loading Finished</h3>

<p>The iframe will send you a message when the project loading is done. It can have different statuses:
In case the project loading was succesful, the message will be the following: <strong>ProjectLoadingSuccess</strong>
In case the project loading failed, the message will be the following: <strong>ProjectLoadingFailed</strong></p>

          <h1 id="other-resources">Other resources</h1>

<p>There are several resources from where you can learn more about EDMdesigner: the official documentation, the tutorials and the example implementations.</p>

<h2 id="docs">Docs</h2>

<table><thead>
<tr>
<th>Document</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="./">Basics</a></td>
<td>This documentation covers the very basics of the integration, like:<ul><li>generating an access token</li><li>making API calls</li><li>managing and opening projects</li><li>managing users</li><li>gallery handling</li></ul></td>
</tr>
<tr>
<td><a href="advanced.html">Advanced</a></td>
<td>This documentation covers more advanced topics. Probably you will only need some of these functionalities. <ul><li>Group handling</li><li>String placeholders</li><li>Dynamic data</li><li>Favorite elements&rsquo; management</li><li>Working with custom data</li><li>Advanced project handling</li><li>API key management</li></ul></td>
</tr>
<tr>
<td><a href="postMessageApi.html">postMessage API</a></td>
<td>By reading this documentation you can learn about how to manipulate the editor itself from the client side. Basically this client side API is based on the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage">postMessage</a> function with which you can send messages between frames from different domains. <ul><li>Basic messages and responses (eg. manual save)</li><li>Hooking on editor events (eg. using your own gallery instead of the built-in one)</li><li>Dynamic data</li><li>Setting elements&rsquo; properties</li></ul></td>
</tr>
<tr>
<td><a href="documentDescriptors.html">Element descriptors</a></td>
<td>A detailed description of our element types used in projects and favorite elements. We generate all of our outputs based on these JSON descriptors.</td>
</tr>
<tr>
<td><a href="builtInGallery.html">Old built-in gallery</a></td>
<td>Don&rsquo;t use it. Use the new postMessage based solution.</td>
</tr>
<tr>
<td><a href="migratingToTheCDNBasedEditor.html">Migrating to the CDN based editor</a></td>
<td>In this article you will learn about how to migrate from the good old version of the editor to the superfast and robust <a href="http://edmdesigner.com/blog/update-edmdesigner-uses-amazon-cloudfront">CDN based version</a>.</td>
</tr>
</tbody></table>

<h2 id="tutorials">Tutorials</h2>

<table><thead>
<tr>
<th>Tutorial</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><a href="tutorialTheBasics.html">The Basics</a></td>
<td>In this tutorial you will learn about our dashboard, the access token generation and the very basic functionalities, like creating and opening projects.</td>
</tr>
<tr>
<td><a href="tutorialAdminFunctionalities.html">Admin Functionalities</a></td>
<td>The biggest take away of this tutorial that you will see how to create new users in our system, so you will be able to associate one user for each of users in your system.</td>
</tr>
<tr>
<td><a href="tutorialGalleryConfig.html">Old Built-in Gallery Configuration</a></td>
<td>In this tutorial you will learn about how to set up the gallery properly, how to implement the hooks on your side and you will also learn about the security of these hooks.</td>
</tr>
</tbody></table>

<h2 id="example-implementations">Example implementations</h2>

<p>Our PHP examples are very well maintained, but the others are probably not up-to-date. Still, they can be a good starting point, but you might want to take a look at the PHP examples as well in the meanwhile.</p>

<ul>
<li><a href="https://github.com/EDMdesigner/EDMdesigner-API-Example-PHP">PHP example</a></li>
<li><a href="https://github.com/EDMdesigner/EDMDesigner-API-Example-PHP-Admin">PHP admin example</a></li>
<li><a href="https://github.com/EDMdesigner/EDMdesigner-API-Example-Node.js">Node.js example</a></li>
<li><a href="https://github.com/EDMdesigner/EDMdesigner-API-Example-ColdFusion">Cold Fusion example</a> - Thank you Tom Chiverton from Extravision! :)</li>
<li><a href="https://github.com/EDMdesigner/EDMDesigner-API-Example-Django">Django example</a> - Thank you Ferenc Vehmann from ZenHeads! :)</li>
</ul>

<p>If you have another example implementation, please let us know, we will fork it and will put a link here.</p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="json">json</a>
          </div>
      </div>
    </div>
  </body>
</html>
